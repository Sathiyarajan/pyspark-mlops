# spark-mlops

# crosstab

```
stats_df=spark.createDataFrame(
[(1, "2017-12-02 03:04:00"),
(1, "2017-12-02 03:45:00"),
(1, "2017-12-02 04:04:00"),
(2, "2017-12-02 04:14:00"),
(2, "2017-12-02 04:54:00"),
(3, "2017-10-01 11:45:20"),
(4, "2017-10-01 02:45:20")]
,["number", "date"])
```

```
+------+-------------------+
|number|               date|
+------+-------------------+
|     1|2017-12-02 03:04:00|
|     1|2017-12-02 03:45:00|
|     1|2017-12-02 04:04:00|
|     2|2017-12-02 04:14:00|
|     2|2017-12-02 04:54:00|
|     3|2017-10-01 11:45:20|
|     4|2017-10-01 02:45:20|
+------+-------------------+
```

```
stats_df.stat.crosstab("date","number").show()
```

```
+-------------------+---+---+---+---+
|        date_number|  1|  2|  3|  4|
+-------------------+---+---+---+---+
|2017-10-01 11:45:20|  0|  0|  1|  0|
|2017-12-02 03:04:00|  1|  0|  0|  0|
|2017-12-02 04:54:00|  0|  1|  0|  0|
|2017-12-02 04:14:00|  0|  1|  0|  0|
|2017-12-02 03:45:00|  1|  0|  0|  0|
|2017-12-02 04:04:00|  1|  0|  0|  0|
|2017-10-01 02:45:20|  0|  0|  0|  1|
+-------------------+---+---+---+---+
```

```
stats_df.withColumn("datehour", substring("date", 0, 13)).stat.crosstab("datehour", "number").show()
```

```
+---------------+---+---+---+---+
|datehour_number|  1|  2|  3|  4|
+---------------+---+---+---+---+
|  2017-10-01 02|  0|  0|  0|  1|
|  2017-10-01 11|  0|  0|  1|  0|
|  2017-12-02 04|  1|  2|  0|  0|
|  2017-12-02 03|  2|  0|  0|  0|
+---------------+---+---+---+---+
```
